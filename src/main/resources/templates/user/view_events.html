<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Upcoming Events</title>
<link rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" />
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<style>
.event-card {
	margin-bottom: 20px;
	cursor: pointer;
	transition: transform 0.1s ease-in-out, box-shadow 0.1s ease-in-out;
}

.card-img {
	background-position: center;
	background-repeat: no-repeat;
	border-radius: 5px 5px 0 0;
}

.event-card:hover {
	transform: scale(1.02);
	box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
}

.event-details {
	display: none; /* Initially hidden */
	margin-top: 10px;
	padding: 15px;
	background-color: #f8f9fa;
	border-top: 1px solid #dee2e6;
	border-radius: 0 0 0.25rem 0.25rem;
}

.site-header {
	background-color: black;
	padding: 10px 0;
	position: fixed;
	top: 0;
	left: 0;
	width: 100%;
	z-index: 1000;
	box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.site-header-inner {
	display: flex;
	justify-content: space-between;
	align-items: center;
	padding: 0 20px;
	max-width: 1200px;
	margin: 0 auto;
}

.brand.header-brand h1 {
	margin: 0;
	font-size: 1.8rem;
	color: #eee;
}

.site-nav ul {
	list-style: none;
	margin: 0;
	padding: 0;
	display: flex;
}

.site-nav ul li {
	margin-left: 20px;
}

.site-nav ul li a {
	color: #eee;
	text-decoration: none;
	font-size: 1.1rem;
	transition: color 0.3s ease;
}

.site-nav ul li a:hover {
	color: #ddd;
}

body {
	padding-top: 60px;
	background-image:
		url('/images/sumaid-pal-singh-bakshi-vq-A3vOlEr0-unsplash.jpg');
	background-size: cover;
	background-repeat: no-repeat;
	background-attachment: fixed;
	background-color: black;
}

h2 {
	color: white;
}

.btn-primary {
	background-color: #505fff;
	border-color: #505fff;
}

.btn-primary:hover {
	background-color: #3d3dff;
	border-color: #3d3dff;
}

.no-tickets {
	color: red;
	font-weight: bold;
}

#ticketAlert {
	display: none;
	position: fixed;
	top: 70px;
	left: 50%;
	transform: translateX(-50%);
	z-index: 1050;
	width: auto;
	max-width: 600px;
}

.ticket-disabled {
	pointer-events: none;
	opacity: 0.6;
}
</style>
</head>
<body>
	<div th:replace="header :: header"></div>

	<div id="ticketAlert" class="alert alert-danger text-center"
		role="alert">Tickets are sold out for this event. You cannot
		book.</div>

	<div class="container mt-5">
		<h2 class="mb-4">Upcoming Events</h2>
		<div th:if="${events.isEmpty()}">
			<div class="alert alert-info">No upcoming events available.</div>
		</div>
		<div th:if="${!events.isEmpty()}" class="row row-cols-1 row-cols-md-3">
			<div th:each="event : ${events}" class="col mb-4">
				<div class="card event-card" th:data-event-id="${event.eventId}">
					<div class="card-img"
						th:style="'background-image: url(/event/image/' + ${event.eventId} + ');
                                    background-size: cover;
                                    height: 200px;'">
					</div>
					<div class="card-body">
						<h5 class="card-title" th:text="${event.name}">Event Name</h5>
						<p class="card-text">
							Category: <span th:text="${event.category}">Category</span><br>
							Date: <span
								th:text="${#temporals.format(event.eventDate, 'dd MMM')}">Date</span><br>
							Location: <span th:text="${event.location}">Location</span> <br>
							Organizer: <span th:text="${event.organizer.name}">Organizer</span>
							<br> Tickets available: <span
								th:text="${event.totalTickets}"
								th:class="${event.totalTickets == 0 ? 'no-tickets' : ''}">Tickets
								available</span>
						</p>
					</div>
					<div class="card-footer event-details">
						<p class="card-text">
							<span th:text="${event.description}">Event Name</span>
						</p>
						<a
							th:href="@{/user/event-details/{eventId}(eventId=${event.eventId})}"
							class="btn btn-primary btn-sm book-ticket-btn"
							th:classappend="${event.totalTickets == 0 ? 'disabled ticket-disabled' : ''}"
							data-total-tickets="${event.totalTickets}">Book Ticket</a>
					</div>
				</div>
			</div>
		</div>
		<a href="/user/dashboard" class="btn btn-primary mt-3">Back to
			Dashboard</a>
	</div>

	<script>
		function confirmTicketAvailability(event, totalTickets) {
			if (totalTickets == 0) {
				alert("Sorry, tickets are sold out for this event.");
				event.preventDefault(); // Prevent the link from being followed
				return false;
			}
			return true;
		}

		$(document).ready(function() {
			$('.event-card').click(function() {
				$(this).find('.event-details').slideToggle('fast');
			});

			$('.book-ticket-btn').click(function(event) {
				var totalTickets = $(this).data('total-tickets');
				if (totalTickets == 0) {
					alert("Sorry, tickets are sold out for this event.");
					event.preventDefault(); // Prevent the link from being followed
				}
			});
		});
	</script>

	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
